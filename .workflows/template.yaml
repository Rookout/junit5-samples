- name: unit-tests
  metadata:
  retryStrategy:
    limit: 1
    retryPolicy: OnError
  inputs:
    parameters:
      - name: repo_name
      - name: branch
    artifacts:
      - name: git
        path: /{{inputs.parameters.repo_name}}/{{inputs.parameters.branch}}
        gcs:
          key: "{{inputs.parameters.repo_name}}/{{inputs.parameters.branch}}/git"
  script:
    image: gradle:8.0-jdk11
    env:
      - name: REPO
        value: "{{inputs.parameters.repo_name}}"
      - name: BRANCH
        value: "{{inputs.parameters.branch}}"
      - name: ROOKOUT_TOKEN
        value: d956a3aa07906fcb9b21ac6386f158f76310504b52637b5ef1703e94fbb2da2d
    workingDir: /{{inputs.parameters.repo_name}}/{{inputs.parameters.branch}}/junit5-migration-gradle
    command: [ sh ]
    source: |
      export JAVA_TOOL_OPTIONS=-javaagent:"/{{inputs.parameters.repo_name}}/{{inputs.parameters.branch}}/junit5-migration-gradle/rook-all.jar" ROOKOUT_CONTROLLER_PORT=443 ROOKOUT_LABELS=env:argo
      gradle test -i
